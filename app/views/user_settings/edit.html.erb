<%= provide(:title, "Edit My Profile" ) %>


<div id="edit_user">

  <div id="myAddTeamModal" class="modal hide fade" style="display: none;">
    <div class="modal-header">
      <a class="close" data-dismiss="modal">×</a>
      <h3>Add a team:</h3>
    </div>
    <%= render :partial => 'partials/team_picker' %>
  </div>

  <div id="myAddLocationModal" class="modal hide fade" style="display: none;">
    <div class="modal-header">
      <a class="close" data-dismiss="modal">×</a>
      <h3>Add a location:</h3>
    </div>
    <%= form_for(@user_location, url: user_user_locations_path(@user, @user_location), remote:true ) do |f| %>
    <div class="modal-body">
      <%= f.label :location_query, "Location" %>
      <%= f.text_field :location_query, placeholder:"eg. Kirkland, WA", required: true %>
    </div>
    <div class="modal-footer">
      <%= f.submit("Add", id:"commit", class:"fanzoButton") %>
    </div>
    <% end %>
  </div>

  <div class="row-fluid">
    <div class="span12 edit_header">
      <h2>Edit Your Fanzo Account</h2>
    </div>
  </div>
  <%= form_for(@user, :url => user_settings_update_path, :html => { :method => :put }) do |f| %>
    <div class="row-fluid">
      <div class="span6 registration_settings">
        <h3>Registration Information</h3>
        <% unless @user.errors.empty? %>
          <h4>There were some problems with your changes:</h4>
          <ul>
            <%= raw @user.errors.full_messages.map { |msg| content_tag(:li, msg) }.join %>
          </ul>
        <% end %>
        
        <%= f.hidden_field :id %>
      
        <%= f.label :email %>
        <%= f.email_field :email %>

        <%= f.label :first_name %>
        <%= f.text_field :first_name %>

        <%= f.label :last_name %>
        <%= f.text_field :last_name %>

        <%= f.label :description %>
        <%= f.text_area :description, rows:6, maxlength:160 %>

      </div>
      <div class="span6 email_settings">
        <h3>Email Settings</h3>
        <div class="check_and_label">
          <%= f.check_box :no_email_on_posts %>
          <%= f.label :no_email_on_posts, "Don't notify me of new posts on my fanzones" %>
        </div>
        <div class="check_and_label">
          <%= f.check_box :no_email_on_comments %>
          <%= f.label :no_email_on_comments, "Don't notify me of new comments on my posts, or other posts I comment on" %>
        </div>
        <div class="check_and_label">
          <%= f.check_box :no_email_on_follows %>
          <%= f.label :no_email_on_follows, "Don't notify me when someone follows one of my fanzones" %>
        </div>
        <div class="check_and_label">
          <%= f.check_box :no_email_newsletter %>
          <%= f.label :no_email_newsletter, "Don't send me the Fanzo Newsletter" %>
        </div>
      </div>
    </div>

    <div class="row-fluid">
      <div class="span6 connections">
        <h3>Connections</h3>
        <div class="connection">
          <%= link_to "Connect To Facebook", omniauth_authorize_path(User, 'facebook'), 
                      id:"facebook-login-button", class:"zocial facebook" %>
          <% if @user.facebook_user_id %>
            <span class="connected">Connected</span>
          <% end %>                      
        </div>
        <div class="connection">
          <%= link_to "Connect To Twitter", omniauth_authorize_path(User, 'twitter'), 
                      id:"connect_twitter_link", class:"zocial twitter" %>
          <% if @user.twitter_user_id %>
            <span class="connected">Connected</span>
          <% end %>                      
        </div>
        <div class="connection">
          <%= link_to "Connect To Instagram", omniauth_authorize_path(User, 'instagram'), 
                      id: "sign-in-with-instagram", class:"zocial instagram" %>
          <% if @user.instagram_user_id %>
            <span class="connected">Connected</span>
          <% end %>                      
        </div>
        <div class="connection">
          <%= link_to "Connect To Foursquare", omniauth_authorize_path(User, 'foursquare'), 
                      id:"foursquare-login-button", class:"zocial foursquare" %>
          <% if @user.foursquare_user_id %>
            <span class="connected">Connected</span>
          <% end %>                      
        </div>
      </div>
      <div class="span6 locations">
        <h3>Your saved locations</h3>
        <div class="saved_locations">
          <ul>
            <% if @user.user_locations.length > 1 %>
              <% @user.user_locations.each do |aUserLocation| %>
                <%  unless aUserLocation.new_record? %>
                  <li id="user_location_<%= aUserLocation.id -%>">
                    <%= render partial: "partials/user_location", locals: { aUserLocation: aUserLocation } %>
                  </li>
                <% end %>
              <% end %>
            <% else %>
              <li class="no_locations">No saved locations</li>
            <% end %>
          </ul>
        </div>
        <div class="add_location">
          <a href="#myAddLocationModal" data-toggle="modal">Add Location</a>
        </div>
      </div>
    </div>

    <div class="row-fluid">
      <div class="edit_buttons span12">
        <div class="save_button">
          <%= f.submit "Save", class: "fanzoButton" %>
        </div>
      </div>
    </div>
  <% end %>

</div>
